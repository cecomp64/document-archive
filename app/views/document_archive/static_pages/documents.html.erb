<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Documents - Article Explorer</title>
    <%= stylesheet_link_tag "document_archive/search", media: "all" %>
</head>
<body>
    <div class="container">
        <header>
            <h1>Browse Documents</h1>
            <p class="subtitle">Explore all documents in the archive</p>
        </header>

        <nav class="main-nav">
            <a href="<%= root_path %>" class="nav-link">Search</a>
            <a href="<%= articles_path %>" class="nav-link">Articles</a>
            <a href="<%= documents_path %>" class="nav-link active">Documents</a>
        </nav>

        <div class="stats-bar" id="statsBar">
            <span id="stats">Loading...</span>
        </div>

        <div class="browse-section">
            <div id="browseResults"></div>
            <div class="pagination">
                <button id="prevButton" disabled>Previous</button>
                <span id="pageInfo"></span>
                <button id="nextButton">Next</button>
            </div>
        </div>
    </div>

    <%= javascript_include_tag "document_archive/common" %>
    <script>
        let currentPage = 0;
        let totalDocuments = 0;
        const documentsPerPage = 20;

        document.addEventListener('DOMContentLoaded', () => {
            DocumentArchive.loadStats('documents');
            loadDocuments(0);
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('prevButton').addEventListener('click', () => {
                if (currentPage > 0) {
                    currentPage--;
                    loadDocuments(currentPage * documentsPerPage);
                }
            });
            document.getElementById('nextButton').addEventListener('click', () => {
                currentPage++;
                loadDocuments(currentPage * documentsPerPage);
            });
        }

        async function loadDocuments(offset) {
            try {
                const response = await fetch(`${DocumentArchive.API_BASE_URL}/api/documents?limit=${documentsPerPage}&offset=${offset}`);
                const data = await response.json();

                totalDocuments = data.total;
                DocumentArchive.displayDocuments(
                    document.getElementById('browseResults'),
                    data.documents,
                    { linkToDetail: true, basePath: '' }
                );
                DocumentArchive.updatePagination({
                    currentPage,
                    totalItems: totalDocuments,
                    itemsPerPage: documentsPerPage,
                    pageInfoId: 'pageInfo',
                    prevButtonId: 'prevButton',
                    nextButtonId: 'nextButton'
                });
            } catch (error) {
                console.error('Error loading documents:', error);
                document.getElementById('browseResults').innerHTML =
                    '<p>Error loading documents. Make sure the API server is running.</p>';
            }
        }
    </script>
</body>
</html>
